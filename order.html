<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <link rel="icon" type="image/x-icon" href="images/Logo_round.png"/>
    <title>Order - WB Bouquet Shop</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://kit.fontawesome.com/9462eee823.js" crossorigin="anonymous"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet"/>
    <link href="https://fonts.googleapis.com/css2?family=Fira+Code&display=swap" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>

    <style>
        :root {
            --primary: #240046;
            --secondary: #3c096c;
            --accent: #5a189a;
            --light: #f8f9fa;
            --light-gray: #eaeaea;
            --medium-gray: #d0d0d0;
            --dark: #212529;
            --text: #333333;
            --text-light: #666666;
            --white: #ffffff;
            --pink: #ff5d8f;
            --light-pink: #ffafcc;
            --border-focus-color: #4A90E2;
            --shadow-color: rgba(0, 0, 0, 0.1);
            --error-text-color: #c53030;
            --error-border-color: #fc8181;
            --error-bg: #fff5f5;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body, html {
            font-family: "Inter", sans-serif;
            background-color: var(--light);
            color: var(--text);
            line-height: 1.6;
            -webkit-font-smoothing: antialiased;
            scroll-behavior: smooth;
        }

        body.fade-out {
            opacity: 0;
            transition: opacity 0.4s ease-out;
        }

        @keyframes page-load-animation {
            from {
                opacity: 0;
            }
            to {
                opacity: 1;
            }
        }

        body {
            animation: page-load-animation 0.5s ease-out;
        }

        .header {
            background-color: var(--white);
            padding: 0 20px;
            position: sticky;
            top: 0;
            z-index: 1000;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.05);
        }

        .navbar {
            max-width: 1200px;
            margin: 0 auto;
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px 0;
        }

        .logo_brand {
            display: flex;
            align-items: center;
            gap: 10px;
            font-size: 1.4rem;
            font-weight: 600;
            text-decoration: none;
            color: var(--accent);
        }

        .logo_brand img {
            height: 45px;
            width: 45px;
            border-radius: 50%;
        }

        .nav-links {
            list-style-type: none;
            display: flex;
            gap: 15px;
        }

        .nav-links a {
            color: var(--text);
            text-decoration: none;
            padding: 8px 12px;
            font-weight: 500;
            transition: all 0.3s cubic-bezier(0.25, 0.8, 0.25, 1);
            font-size: 0.95rem;
            border-radius: 6px;
            display: flex;
            align-items: center;
            position: relative;
            gap: 6px;
        }

        .nav-links a:hover {
            background-color: rgba(36, 0, 70, 0.05);
        }

        .nav-links a.active {
            background-color: var(--accent);
            color: var(--white) !important;
        }

        main {
            padding: 3rem 1rem;
        }

        .form-container {
            max-width: 900px;
            margin: 0 auto;
            background-color: var(--white);
            border-radius: 12px;
            box-shadow: 0 5px 15px var(--shadow-color);
            padding: 2.5rem;
        }

        .form-header {
            text-align: center;
            margin-bottom: 2.5rem;
        }

        .form-header h1 {
            color: var(--primary);
            font-size: 2rem;
            font-weight: 700;
        }

        .form-header p {
            color: var(--text-light);
            margin-top: 0.5rem;
        }

        .form-grid-wrapper {
            display: flex;
            flex-direction: column;
            gap: 1.5rem;
        }

        .form-grid {
            display: grid;
            gap: 1.5rem;
        }

        .grid-col-2 {
            grid-template-columns: repeat(2, 1fr);
        }

        .grid-col-3 {
            grid-template-columns: repeat(3, 1fr);
        }

        .form-group {
            display: flex;
            flex-direction: column;
            gap: 8px;
            position: relative;
        }

        .form-group label {
            font-weight: 500;
            color: var(--text);
            font-size: 0.9rem;
        }

        .input-field, select, textarea {
            width: 100%;
            padding: 12px;
            border: 1px solid var(--medium-gray, #ccc);
            border-radius: 8px;
            font-size: 1rem;
            font-family: 'Inter', sans-serif;
            background-color: var(--light);
            transition: all 0.2s ease;
        }

        .input-field:focus, select:focus, textarea:focus {
            outline: none;
            border-color: var(--accent);
            box-shadow: 0 0 0 3px rgba(90, 24, 154, 0.15);
        }

        .input-group {
            display: flex;
            align-items: center;
        }

        .input-group .prefix {
            padding: 0 15px;
            color: var(--text-light);
            font-weight: 500;
            border: 1px solid var(--medium-gray);
            border-right: none;
            border-radius: 8px 0 0 8px;
            height: 49px;
            display: flex;
            align-items: center;
            background-color: var(--light-gray);
        }

        .input-group .input-field {
            border-radius: 0 8px 8px 0;
            border-left: none;
        }

        .input-group.input-error .prefix, .input-error {
            border-color: var(--error-border-color) !important;
        }

        .input-field.input-error:focus, .input-group:has(.input-field.input-error:focus) {
            border-color: var(--error-border-color) !important;
            box-shadow: 0 0 0 3px var(--error-bg) !important;
        }

        input[type=number]::-webkit-inner-spin-button, input[type=number]::-webkit-outer-spin-button {
            -webkit-appearance: none;
            margin: 0;
        }

        input[type=number] {
            -moz-appearance: textfield;
        }

        #drop-zone {
            cursor: pointer;
        }

        .preview-item {
            position: relative;
            width: 100%;
            padding-top: 100%;
            border-radius: 0.5rem;
            overflow: hidden;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        }

        .preview-img {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .delete-btn {
            position: absolute;
            top: 0.5rem;
            right: 0.5rem;
            width: 28px;
            height: 28px;
            background-color: rgba(0, 0, 0, 0.6);
            color: white;
            border: none;
            border-radius: 50%;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 16px;
            opacity: 0;
            transition: opacity 0.3s ease;
            z-index: 10;
        }

        .preview-item:hover .delete-btn {
            opacity: 1;
        }

        .radio-options-group {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1rem;
        }

        .radio-label {
            display: flex;
            align-items: center;
            padding: 1rem;
            border: 1px solid var(--medium-gray);
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .radio-label:has(input:checked) {
            background-color: #f9f2ff;
            border-color: var(--accent);
        }

        .radio-label input {
            display: none;
        }

        .radio-label .custom-radio {
            width: 20px;
            height: 20px;
            border: 2px solid var(--medium-gray);
            border-radius: 50%;
            margin-right: 0.5rem;
            display: grid;
            place-items: center;
            transition: border-color 0.3s ease;
        }

        .radio-label .custom-radio::before {
            content: '';
            width: 10px;
            height: 10px;
            background-color: var(--accent);
            border-radius: 50%;
            transform: scale(0);
            transition: transform 0.2s ease-in-out;
        }

        .radio-label input:checked + .custom-radio {
            border-color: var(--accent);
        }

        .radio-label input:checked + .custom-radio::before {
            transform: scale(1);
        }

        .radio-label .icon {
            margin-right: 0.5rem;
            color: var(--text-light);
            transition: color 0.3s ease;
        }

        .radio-label:has(input:checked) .icon {
            color: var(--accent);
        }

        .btn {
            padding: 14px 28px;
            border-radius: 8px;
            border: none;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            font-size: 1rem;
            text-decoration: none;
        }

        .btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }

        .btn-primary {
            background: linear-gradient(135deg, var(--primary) 0%, var(--accent) 100%);
            color: var(--white);
            box-shadow: 0 4px 12px rgba(36, 0, 70, 0.2);
        }

        .btn-primary:hover:not(:disabled) {
            transform: translateY(-3px);
            box-shadow: 0 6px 18px rgba(36, 0, 70, 0.3);
        }

        .btn-outline {
            background-color: transparent;
            border: 2px solid var(--accent);
            color: var(--accent);
            text-decoration: none;
            position: relative;
            overflow: hidden;
            z-index: 1;
            transition: color 0.3s ease;
        }

        .btn-outline::before {
            content: "";
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: var(--primary);
            z-index: -1;
            transform: scaleX(0);
            transform-origin: left;
            transition: transform 0.3s ease;
        }

        .btn-outline:hover:not(:disabled)::before {
            transform: scaleX(1);
        }

        .btn-outline:hover:not(:disabled) {
            color: var(--white) !important;
        }

        .error-message {
            color: var(--error-text-color);
            font-size: 0.8rem;
            margin-top: -4px;
            display: none;
        }

        footer {
            background: linear-gradient(135deg, var(--primary) 0%, var(--accent) 100%);
            color: var(--white);
            padding: 60px 20px 20px;
            margin-top: 50px;
        }

        .footer-content {
            max-width: 1200px;
            margin: 0 auto;
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 40px;
        }

        .footer-column h3 {
            font-size: 1.3rem;
            margin-bottom: 25px;
            font-weight: 600;
            color: var(--white);
            position: relative;
            padding-bottom: 10px;
        }

        .footer-column h3:after {
            content: "";
            position: absolute;
            bottom: 0;
            left: 0;
            width: 50px;
            height: 3px;
            background: var(--white);
            border-radius: 2px;
        }

        .footer-links {
            list-style-type: none;
            padding: 0;
        }

        .footer-links li {
            margin-bottom: 15px;
        }

        .footer-links a {
            color: rgba(255, 255, 255, 0.8);
            text-decoration: none;
            transition: all 0.2s ease;
            display: flex;
            align-items: center;
            gap: 10px;
            font-size: 1rem;
        }

        .footer-links a:hover {
            color: var(--white);
            transform: translateX(5px);
        }

        .copyright {
            text-align: center;
            padding-top: 40px;
            margin-top: 40px;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
            color: rgba(255, 255, 255, 0.6);
            font-size: 0.95rem;
        }

        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.7);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 2000;
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.3s ease, visibility 0.3s ease;
        }

        .modal-overlay.show {
            opacity: 1;
            visibility: visible;
        }

        .modal-content {
            background-color: var(--white);
            padding: 2rem;
            border-radius: 12px;
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.2);
            width: 90%;
            max-width: 480px;
            text-align: center;
            transform: scale(0.9);
            transition: transform 0.3s ease;
        }

        .modal-overlay.show .modal-content {
            transform: scale(1);
        }

        .modal-content h2 {
            color: var(--primary);
            font-size: 1.5rem;
            margin-bottom: 1rem;
        }

        .modal-content p {
            color: var(--text-light);
            margin-bottom: 1.5rem;
            line-height: 1.5;
        }

        .modal-actions {
            display: flex;
            flex-direction: column;
            gap: 0.8rem;
            margin-top: 1.5rem;
        }

        .btn-cancel-modal {
            background-color: #e5e7eb;
            color: #4b5563;
            font-weight: 500;
        }

        .btn-cancel-modal:hover {
            background-color: #d1d5db;
        }

        #receipt-image-container img {
            border: 1px solid var(--light-gray);
            border-radius: 4px;
            max-width: 100%;
            margin: 1rem 0;
        }

        #receipt-template {
            font-family: 'Fira Code', monospace;
            background: #fff;
            color: #000;
            padding: 20px;
            width: 320px;
            font-size: 12px;
            line-height: 1.6;
        }

        #receipt-template h4 {
            text-align: center;
            font-size: 16px;
            margin-bottom: 4px;
        }

        #receipt-template .subtitle {
            text-align: center;
            font-size: 10px;
            margin-bottom: 15px;
        }

        #receipt-template .line {
            border-top: 1px dashed #000;
            margin: 10px 0;
        }

        #receipt-template .item-row {
            display: flex;
            justify-content: space-between;
        }

        .spinner {
            border: 4px solid #f3f3f3;
            border-top: 4px solid var(--accent);
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 20px auto;
        }

        @keyframes spin {
            0% {
                transform: rotate(0deg);
            }
            100% {
                transform: rotate(360deg);
            }
        }

        /* === PERBAIKAN UNTUK TAMPILAN MOBILE === */
        @media (max-width: 768px) {
            .grid-col-2, .grid-col-3 {
                grid-template-columns: 1fr;
            }

            .navbar {
                flex-direction: column;
                height: auto;
                padding: 1rem;
                gap: 15px;
                align-items: center; /* Memastikan logo dan nav terpusat */
            }

            .logo_brand {
                font-size: 1.2rem; /* Sedikit mengecilkan font logo */
            }

            .nav-links {
                gap: 5px; /* Mengurangi jarak antar menu nav */
                flex-wrap: wrap; /* Memungkinkan menu turun jika tidak muat */
                justify-content: center; /* Pusatkan menu */
            }

            main {
                /* Mengurangi padding utama di mobile agar form lebih lebar */
                padding: 1.5rem 1rem;
            }

            .form-container {
                /* Mengurangi padding form di mobile */
                padding: 1.5rem;
            }

            .form-header h1 {
                /* Menyesuaikan ukuran judul di mobile */
                font-size: 1.75rem;
            }

            .form-header p {
                font-size: 0.95rem; /* Menyesuaikan ukuran sub-judul */
            }

            /* Membuat grup radio button menjadi 1 kolom di mobile */
            .radio-options-group {
                grid-template-columns: 1fr;
            }

            .footer-content {
                /* Membuat konten footer menjadi 1 kolom dan terpusat */
                grid-template-columns: 1fr;
                text-align: center;
                gap: 30px;
            }

            .footer-column h3:after {
                /* Memusatkan garis bawah judul footer */
                left: 50%;
                transform: translateX(-50%);
            }

            .footer-links a {
                /* Memusatkan link di footer */
                justify-content: center;
            }

            .footer-links a:hover {
                /* Menonaktifkan efek hover geser di mobile */
                transform: none;
            }
        }

        @media (max-width: 480px) {
            .nav-links a {
                padding: 8px 10px; /* Padding lebih kecil untuk tombol nav */
                font-size: 0.9rem;
            }

            .form-container {
                padding: 1rem; /* Padding lebih kecil lagi untuk layar sempit */
            }

            .modal-content {
                width: 95%;
                padding: 1.5rem;
            }
        }
    </style>
</head>
<body>

<header class="header">
    <nav class="navbar">
        <a href="index.html" class="logo_brand">
            <img src="images/Logo.png" alt="Logo"/>
            <span>Wiwid Beauty | Bouquet Shop</span>
        </a>
        <ul class="nav-links">
            <li><a href="index.html"><i class="fa-solid fa-house"></i>Beranda</a></li>
            <li><a href="order.html" class="active"><i class="fa-solid fa-envelope"></i>Order</a></li>
            <li><a href="produk.html"> <i class="fa-solid fa-store"></i>Produk </a></li>
            <li><a href="keranjang.html"><i class="fa-solid fa-cart-shopping"></i>Keranjang</a></li>
        </ul>
    </nav>
</header>

<main>
    <div class="form-container">
        <div class="form-header">
            <h1>Formulir Pemesanan</h1>
            <p>Silakan isi detail pesanan Anda di bawah ini.</p>
        </div>
        <form id="orderForm" novalidate>
            <div class="form-grid-wrapper">
                <div class="form-grid grid-col-2">
                    <div class="form-group"><label for="fullName">Nama Lengkap</label><input type="text" id="fullName"
                                                                                             name="fullName"
                                                                                             class="input-field"
                                                                                             placeholder="Contoh: Naufal Abbad"
                                                                                             required
                                                                                             oninput="capitalizeName(this)">
                        <p class="error-message" id="fullName-error"></p></div>
                    <div class="form-group"><label for="whatsappNumber">Nomor WhatsApp</label>
                        <div class="input-group" id="whatsapp-group"><span class="prefix">+62</span><input type="tel"
                                                                                                           id="whatsappNumber"
                                                                                                           name="whatsappNumber"
                                                                                                           class="input-field"
                                                                                                           placeholder="812-3456-7890"
                                                                                                           required
                                                                                                           oninput="formatPhoneNumber(this)"
                                                                                                           maxlength="15">
                        </div>
                        <p class="error-message" id="whatsappNumber-error"></p></div>
                </div>
                <div class="form-grid grid-col-2">
                    <div class="form-group"><label for="kategori_barang">Kategori Produk</label><select
                            id="kategori_barang" name="kategori_barang" class="input-field" required>
                        <option value="" disabled selected>Pilih Kategori</option>
                        <option value="Buket Bunga">Buket Bunga</option>
                        <option value="Buket Balon">Buket Balon</option>
                        <option value="Hampers">Hampers</option>
                    </select>
                        <p class="error-message" id="kategori_barang-error"></p></div>
                    <div class="form-group" id="jenis_buket_group"><label for="jenis_buket">Jenis Produk</label><select
                            id="jenis_buket" name="jenis_buket" class="input-field" required>
                        <option value="" disabled selected>Pilih Jenis</option>
                    </select>
                        <p class="error-message" id="jenis_buket-error"></p></div>
                </div>
                <div class="form-grid grid-col-3">
                    <div class="form-group"><label for="jumlah_pesanan">Jumlah</label><input type="number"
                                                                                             id="jumlah_pesanan"
                                                                                             name="jumlah_pesanan"
                                                                                             class="input-field" min="1"
                                                                                             value="1" required>
                        <p class="error-message" id="jumlah_pesanan-error"></p></div>
                    <div class="form-group" id="nuansa_warna_group"><label for="nuansa_warna">Nuansa Warna</label><input
                            type="text" id="nuansa_warna" name="nuansa_warna" class="input-field"
                            placeholder="Contoh: Pastel, Earth tone"></div>
                    <div class="form-group" id="ukuran_group"><label for="ukuran">Ukuran</label><select id="ukuran"
                                                                                                        name="ukuran"
                                                                                                        class="input-field"
                                                                                                        required>
                        <option value="" disabled selected>Pilih Ukuran</option>
                        <option value="Small">Small</option>
                        <option value="Medium">Large</option>
                        <option value="Large">Big</option>
                    </select>
                        <p class="error-message" id="ukuran-error"></p></div>
                </div>
                <div class="form-grid grid-col-2">
                    <div class="form-group">
                        <label for="harga_mulai">Harga Mulai Dari</label>
                        <select id="harga_mulai" name="harga_mulai" class="input-field" required>
                            <option value="" disabled selected>Pilih Kategori Harga</option>
                        </select>
                        <p class="error-message" id="harga_mulai-error"></p>
                    </div>
                    <div class="form-group">
                        <label for="tanggal-acara">Untuk Tanggal Berapa</label>
                        <input type="date" name="tanggal-acara" id="tanggal-acara" class="input-field" required>
                        <p class="error-message" id="tanggal-acara-error"></p>
                    </div>
                </div>
                <div class="form-group">
                    <label>Unggah Foto Referensi <span class="font-normal text-gray-400">(Opsional) Bisa dilihat di Beranda / Instagram @wiwidbeauty</span></label>
                    <label for="file-upload" id="drop-zone"
                           class="mt-1 flex justify-center px-6 pt-5 pb-6 border-2 border-gray-300 border-dashed rounded-lg transition-colors duration-300 cursor-pointer">
                        <div id="upload-prompt" class="space-y-1 text-center pointer-events-none">
                            <svg class="mx-auto h-12 w-12 text-gray-400" stroke="currentColor" fill="none"
                                 viewBox="0 0 48 48" aria-hidden="true">
                                <path d="M28 8H12a4 4 0 00-4 4v20m32-12v8m0 0v8a4 4 0 01-4 4H12a4 4 0 01-4-4v-4m32-4l-3.172-3.172a4 4 0 00-5.656 0L28 28M8 32l9.172-9.172a4 4 0 015.656 0L28 28m0 0l4 4m4-24h8m-4-4v8"
                                      stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                            </svg>
                            <div class="flex text-sm text-gray-600 justify-center"><span
                                    class="relative bg-white rounded-md font-medium text-gray-600"><span>Pilih file</span></span>
                                <p class="pl-1">atau tarik dan lepas</p></div>
                            <p class="text-xs text-gray-500">PNG, JPG, GIF hingga 10MB</p></div>
                    </label>
                    <input id="file-upload" name="file-upload" type="file" class="sr-only" multiple accept="image/*">
                    <div id="preview-container" class="mt-4 grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 gap-4"></div>
                </div>
                <div class="form-group">
                    <label>Opsi Pengambilan</label>
                    <div class="radio-options-group"><label class="radio-label"><input type="radio"
                                                                                       name="opsi_pengambilan"
                                                                                       value="diambil_sendiri" checked>
                        <div class="custom-radio"></div>
                        <i class="fa-solid fa-store icon"></i><span>Diambil Sendiri</span></label><label
                            class="radio-label"><input type="radio" name="opsi_pengambilan" value="diantar">
                        <div class="custom-radio"></div>
                        <i class="fa-solid fa-truck icon"></i><span>Diantar</span></label></div>
                </div>
                <div id="alamat-group" class="form-group" style="display: none;"><label for="alamat">Alamat
                    Lengkap</label><textarea id="alamat" name="alamat" class="input-field"
                                             placeholder="Masukkan jalan, kota, dan kode pos"></textarea>
                    <p class="error-message" id="alamat-error"></p></div>
                <div class="form-group"><label for="pesan">Pesan (Opsional)</label><textarea id="pesan" name="pesan"
                                                                                             class="input-field"
                                                                                             placeholder="Tinggalkan catatan tambahan di sini jika ada..."></textarea>
                </div>
                <div class="flex justify-center">
                    <button type="submit" id="submit-btn" class="btn btn-outline"><i
                            class="fa-solid fa-paper-plane"></i>Kirim Pesanan
                    </button>
                </div>
            </div>
        </form>
    </div>
</main>

<footer>
    <div class="footer-content">
        <div class="footer-column">
            <h3>Wiwid Bouquet</h3>
            <p>Merangkai cerita Anda dalam keindahan yang tak terlupakan. Temukan buket yang bukan hanya indah
                dipandang, tapi juga hangat di hati.</p>
        </div>
        <div class="footer-column">
            <h3>Hubungi Kami</h3>
            <ul class="footer-links">
                <li><a href="https://maps.app.goo.gl/8B63tYUqgUX9niEn7" target="_blank"><i
                        class="fa-solid fa-location-dot"></i><span>Jl. Raya Talok, Garum, Blitar</span></a></li>
                <li><a href="tel:+6285736834477"><i class="fa-solid fa-phone"></i><span>+62 857-3683-4477</span></a>
                </li>
                <li><a href="https://www.instagram.com/wiwidbeauty/" target="_blank"><i
                        class="fab fa-instagram"></i><span>@wiwidbeauty</span></a></li>
            </ul>
        </div>
    </div>
    <div class="copyright">
        <p>© 2025 Wiwid Bouquet. Hak Cipta Dilindungi.</p>
    </div>
</footer>

<div id="receipt-template" style="position: absolute; left: -9999px; top: 0;">
    <h4>Wiwid Bouquet Shop</h4>
    <p class="subtitle">Jl. Raya Talok, Garum, Blitar</p>
    <div id="receipt-details"></div>
    <div class="line"></div>
    <div id="receipt-items"></div>
    <div class="line"></div>
    <div class="footer">--- Terima Kasih Telah Berbelanja ---<br>Struk ini adalah bukti pemesanan.</div>
</div>

<div id="confirmation-modal" class="modal-overlay">
    <div class="modal-content">
        <div id="modal-view-choice"><h2>Konfirmasi Pesanan</h2>
            <p>Pesanan Anda sudah siap dikirim ke admin. Lanjutkan?</p>
            <div class="modal-actions">
                <button id="btn-confirm" class="btn btn-primary">Ya, Lanjutkan</button>
                <button id="btn-cancel-modal" class="btn btn-cancel-modal">Batal</button>
            </div>
        </div>
        <div id="modal-view-loading" style="display: none;"><h2>Memproses Pesanan...</h2>
            <div class="spinner"></div>
            <p>Mohon tunggu sebentar, kami sedang mengirimkan pesanan Anda ke admin.</p></div>
        <div id="modal-view-success" style="display: none;"><h2>Berhasil!</h2>
            <p>Pesanan Anda telah terkirim. Admin kami akan segera menghubungi Anda via WhatsApp untuk konfirmasi lebih
                lanjut. Anda bisa melihat struk pesanan Anda di bawah ini.</p>
            <div id="receipt-image-container"></div>
            <div class="modal-actions">
                <button id="btn-close-modal" class="btn btn-primary">Tutup</button>
            </div>
        </div>
        <div id="modal-view-error" style="display: none;"><h2>Gagal</h2>
            <p id="error-text">Maaf, terjadi kesalahan saat mengirim pesanan. Silakan coba lagi atau hubungi admin
                langsung.</p>
            <div class="modal-actions">
                <button id="btn-close-error-modal" class="btn btn-primary">Tutup</button>
            </div>
        </div>
    </div>
</div>

<script>
    // --- KONFIGURASI PENTING ---
    const BACKEND_URL = 'https://ganti-dengan-url-ngrok-anda.ngrok-free.app'; // Ganti setelah menjalankan ngrok

    // --- DEKLARASI ELEMEN ---
    const form = document.getElementById('orderForm');
    const modal = document.getElementById('confirmation-modal');
    const modalViews = {
        choice: document.getElementById('modal-view-choice'),
        loading: document.getElementById('modal-view-loading'),
        success: document.getElementById('modal-view-success'),
        error: document.getElementById('modal-view-error'),
    };
    const btnConfirm = document.getElementById('btn-confirm');
    const btnCancelModal = document.getElementById('btn-cancel-modal');
    const btnCloseModal = document.getElementById('btn-close-modal');
    const btnCloseErrorModal = document.getElementById('btn-close-error-modal');
    const receiptImageContainer = document.getElementById('receipt-image-container');
    const errorText = document.getElementById('error-text');
    const {kategori_barang} = form.elements;
    const jenisBuketGroup = document.getElementById('jenis_buket_group');
    const jenisBuketLabel = jenisBuketGroup.querySelector('label');
    const ukuranGroup = document.getElementById('ukuran_group');
    const nuansaWarnaGroup = document.getElementById('nuansa_warna_group');
    const alamatGroup = document.getElementById('alamat-group');
    const alamatTextarea = document.getElementById('alamat');
    const hargaMulaiSelect = document.getElementById('harga_mulai');

    // --- FUNGSI UTILITAS ---
    function capitalizeName(input) {
        input.value = input.value.replace(/\b\w/g, char => char.toUpperCase());
    }

    function formatPhoneNumber(input) {
        let value = input.value.replace(/\D/g, '');
        if (value.startsWith('0')) value = value.substring(1);
        value = value.substring(0, 12);
        if (value.length > 7) value = value.replace(/(\d{3})(\d{4})(\d{1,5})/, '$1-$2-$3');
        else if (value.length > 3) value = value.replace(/(\d{3})(\d{1,4})/, '$1-$2');
        input.value = value;
    }

    const tomorrow = new Date();
    tomorrow.setDate(tomorrow.getDate() + 1);
    form.elements['tanggal-acara'].min = tomorrow.toISOString().split("T")[0];

    const optionsData = {
        'Buket Bunga': {
            label: 'Jenis Buket',
            jenis: ['Buket Wisuda', 'Buket Ulang Tahun', 'Buket Anniversary'],
            harga: {
                '15000-50000': 'Rp 15.000 - Rp 50.000',
                '100000': 'Rp 100.000',
                '150000': 'Rp 150.000',
                '200000': 'Rp 200.000',
                '250000': 'Rp 250.000',
                '350000': 'Rp 350.000',
                '500000': 'Rp 500.000'
            },
            showUkuran: true,
            showNuansa: true
        },
        'Buket Balon': {
            label: 'Jenis Buket Balon',
            jenis: ['Balon Karakter', 'Balon Angka/Huruf', 'Balon Custom'],
            harga: {'150000-185000': 'Rp 150.000 - Rp 185.000'},
            showUkuran: false,
            showNuansa: true
        },
        'Hampers': {
            label: 'Jenis Hampers',
            jenis: ['Hampers Lebaran', 'Hampers Natal', 'Hampers Makanan Ringan'],
            harga: {'100000': 'Rp 100.000', '250000': 'Rp 250.000', '500000': 'Rp 500.000'},
            showUkuran: false,
            showNuansa: false
        }
    };

    // PERBAIKAN 2: Fungsi diubah untuk mengurutkan harga
    function updateFormFields(category) {
        if (!optionsData[category]) return;
        const config = optionsData[category];
        jenisBuketLabel.textContent = config.label;
        form.elements.jenis_buket.innerHTML = '<option value="" disabled selected>Pilih Jenis...</option>';
        config.jenis.forEach(opt => {
            const option = document.createElement('option');
            option.value = opt;
            option.textContent = opt;
            form.elements.jenis_buket.appendChild(option)
        });

        hargaMulaiSelect.innerHTML = '<option value="" disabled selected>Pilih Kategori Harga</option>';

        // Mengurutkan harga dari yang termurah
        const sortedPrices = Object.entries(config.harga).sort((a, b) => {
            const priceA = parseInt(a[0].split('-')[0], 10);
            const priceB = parseInt(b[0].split('-')[0], 10);
            return priceA - priceB;
        });

        sortedPrices.forEach(([value, text]) => {
            const option = document.createElement('option');
            option.value = value;
            option.textContent = text;
            hargaMulaiSelect.appendChild(option)
        });

        ukuranGroup.style.display = config.showUkuran ? 'flex' : 'none';
        nuansaWarnaGroup.style.display = config.showNuansa ? 'flex' : 'none'
    }

    kategori_barang.addEventListener('change', (e) => updateFormFields(e.target.value));

    document.querySelectorAll('input[name="opsi_pengambilan"]').forEach(option => {
        option.addEventListener('change', (e) => {
            if (e.target.value === 'diantar') {
                alamatGroup.style.display = 'flex';
                alamatTextarea.required = true;
            } else {
                alamatGroup.style.display = 'none';
                alamatTextarea.required = false;
            }
        });
    });

    function switchModalView(viewName) {
        Object.values(modalViews).forEach(view => view.style.display = 'none');
        if (modalViews[viewName]) modalViews[viewName].style.display = 'block';
    }

    function hideModal() {
        modal.classList.remove('show');
    }

    function populateReceiptTemplate() {
        const receiptDetails = document.getElementById('receipt-details');
        const receiptItems = document.getElementById('receipt-items');
        const data = Object.fromEntries(new FormData(form).entries());
        const orderDate = new Date().toLocaleDateString('id-ID', {day: '2-digit', month: '2-digit', year: 'numeric'});
        const orderTime = new Date().toLocaleTimeString('id-ID', {hour: '2-digit', minute: '2-digit'});
        receiptDetails.innerHTML = `<div class="item-row"><span>Tanggal:</span> <span>${orderDate} ${orderTime}</span></div><div class="item-row"><span>Pemesan:</span> <span>${data.fullName}</span></div><div class="item-row"><span>Tgl Acara:</span> <span>${new Date(data['tanggal-acara']).toLocaleDateString('id-ID')}</span></div>`;
        const hargaText = hargaMulaiSelect.options[hargaMulaiSelect.selectedIndex].text;
        receiptItems.innerHTML = `<p><strong>${data.kategori_barang} - ${data.jenis_buket}</strong></p><p style="font-size: 10px; margin-left: 10px;">${data.ukuran ? `Ukuran: ${data.ukuran}` : ''} ${data.nuansa_warna ? `| Warna: ${data.nuansa_warna}` : ''}</p><div class="item-row"><span>${data.jumlah_pesanan} x (${hargaText})</span><span class="price">${hargaText}</span></div>`;
    }

    function getOrderDetailsText() {
        const data = Object.fromEntries(new FormData(form).entries());
        let details = `*Nama Pelanggan:* ${data.fullName}\n`;
        details += `*Kategori:* ${data.kategori_barang}\n`;
        details += `*Jenis:* ${data.jenis_buket}\n`;
        if (data.ukuran) details += `*Ukuran:* ${data.ukuran}\n`;
        if (data.nuansa_warna) details += `*Nuansa Warna:* ${data.nuansa_warna}\n`;
        details += `*Jumlah:* ${data.jumlah_pesanan}\n`;
        details += `*Budget:* ${hargaMulaiSelect.options[hargaMulaiSelect.selectedIndex].text}\n`;
        details += `*Tgl Acara:* ${new Date(data['tanggal-acara']).toLocaleDateString('id-ID')}\n`;
        details += `*Pengambilan:* ${data.opsi_pengambilan === 'diantar' ? 'Diantar' : 'Diambil Sendiri'}\n`;
        if (data.opsi_pengambilan === 'diantar') details += `*Alamat:* ${data.alamat}\n`;
        if (data.pesan) details += `*Pesan Tambahan:* ${data.pesan}`;
        return details;
    }

    async function handleOrderSubmission() {
        switchModalView('loading');
        let canvas;
        try {
            populateReceiptTemplate();
            canvas = await html2canvas(document.getElementById('receipt-template'), {scale: 2, useCORS: true});
        } catch (err) {
            console.error("Gagal membuat canvas:", err);
            errorText.textContent = "Gagal membuat gambar struk.";
            switchModalView('error');
            return;
        }
        const imageData = canvas.toDataURL('image/png');

        let receiptUrlPath;
        try {
            const uploadResponse = await fetch(`${BACKEND_URL}/upload-receipt`, {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify({image: imageData})
            });
            if (!uploadResponse.ok) throw new Error(`Server error: ${uploadResponse.statusText}`);
            const result = await uploadResponse.json();
            receiptUrlPath = result.imageUrlPath;
        } catch (err) {
            console.error("Gagal upload:", err);
            errorText.textContent = "Gagal mengunggah struk ke server. Pastikan server dan ngrok berjalan dengan benar.";
            switchModalView('error');
            return;
        }
        const fullReceiptUrl = `${BACKEND_URL}${receiptUrlPath}`;

        try {
            const notifyResponse = await fetch(`${BACKEND_URL}/notify-admin`, {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify({
                    orderDetails: getOrderDetailsText(),
                    customerWa: form.elements.whatsappNumber.value,
                    receiptUrl: fullReceiptUrl
                })
            });
            if (!notifyResponse.ok) throw new Error('Gagal mengirim notifikasi.');
        } catch (err) {
            console.error("Gagal notifikasi:", err);
            errorText.textContent = "Gagal mengirim notifikasi ke admin. Periksa token bot dan chat ID di server.";
            switchModalView('error');
            return;
        }

        receiptImageContainer.innerHTML = `<img src="${fullReceiptUrl}" alt="Struk Pesanan Anda">`;
        switchModalView('success');
        form.reset();
    }

    btnConfirm.addEventListener('click', handleOrderSubmission);

    function showError(el, msg) {
        const errEl = document.getElementById(`${el.id}-error`);
        if (errEl) {
            errEl.textContent = msg;
            errEl.style.display = 'block';
        }
        (el.closest('.input-group') || el).classList.add('input-error');
    }

    function clearError(el) {
        const errEl = document.getElementById(`${el.id}-error`);
        if (errEl) {
            errEl.style.display = 'none';
        }
        (el.closest('.input-group') || el).classList.remove('input-error');
    }

    form.addEventListener('submit', function (e) {
        e.preventDefault();
        let isValid = true;
        let firstInvalidElement = null;
        document.querySelectorAll('.error-message').forEach(el => el.style.display = 'none');
        document.querySelectorAll('.input-error').forEach(el => el.classList.remove('input-error'));
        const fieldsToValidate = [{
            element: form.fullName,
            message: 'Nama lengkap tidak boleh kosong.'
        }, {
            element: form.whatsappNumber,
            message: 'Nomor WhatsApp tidak boleh kosong.'
        }, {element: form.kategori_barang, message: 'Kategori produk harus dipilih.'}, {
            element: form.jenis_buket,
            message: 'Jenis produk harus dipilih.'
        }, {
            element: form.jumlah_pesanan,
            message: 'Jumlah pesanan tidak boleh nol atau kurang.',
            condition: el => parseInt(el.value, 10) <= 0
        }, {element: form['tanggal-acara'], message: 'Tanggal acara harus diisi.'}, {
            element: form.harga_mulai,
            message: 'Kategori harga harus dipilih.'
        }, {
            element: form.ukuran,
            message: 'Ukuran harus dipilih.',
            condition: el => ukuranGroup.style.display !== 'none' && !el.value
        }, {
            element: form.alamat,
            message: 'Alamat lengkap tidak boleh kosong saat memilih opsi diantar.',
            condition: el => document.querySelector('input[name="opsi_pengambilan"]:checked').value === 'diantar' && !el.value.trim()
        }];
        fieldsToValidate.forEach(field => {
            const condition = field.condition ? field.condition(field.element) : !field.element.value.trim();
            if (condition) {
                showError(field.element, field.message);
                isValid = false;
                if (!firstInvalidElement) {
                    firstInvalidElement = field.element;
                }
            }
        });
        if (!isValid && firstInvalidElement) {
            firstInvalidElement.scrollIntoView({behavior: 'smooth', block: 'center'});
        } else if (isValid) {
            switchModalView('choice');
            modal.classList.add('show');
        }
    });

    form.querySelectorAll('input, select, textarea').forEach(input => {
        input.addEventListener('input', () => clearError(input));
        input.addEventListener('change', () => clearError(input));
    });
    [btnCancelModal, btnCloseModal, btnCloseErrorModal].forEach(btn => btn.addEventListener('click', hideModal));
    modal.addEventListener('click', (e) => {
        if (e.target === modal) hideModal();
    });

    document.addEventListener('DOMContentLoaded', () => {
        updateFormFields(kategori_barang.value || 'Buket Bunga');
    });
</script>

</body>
</html>